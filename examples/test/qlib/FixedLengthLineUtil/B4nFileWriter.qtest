#!/usr/bin/env qore
%require-types
%new-style
%enable-all-warnings
%requires UnitTest
%requires FixedLengthLineFileUtil

UnitTest unit();

string file = unit.tmpLocation() + "/file.b4n";
unlink(file);

list data = (
    ("col1" : "aaaaa", "col2" : "bb"),
    ("col3" : "c", "col4" : "ddd", "col5" : "eeeeee"),
    ("col1" : "fffff", "col2" : "gg"),
);

string data_text = "aaaaabb\ncdddeeeeee\nfffffgg\n";


list specs = (
    (
        "test" : bool sub (string line) {return line.length() == 7;},
        "cols" : (
            "col1" : 5,
            "col2" : 2,
        ),
    ),
    (
        "test" : bool sub (string line) {return line.length() == 10;},
        "cols" : (
            "col3" : 1,
            "col4" : 3,
            "col5" : 6,
        ),
    ),
);

B4nFileWriter w(file, specs);
w.write(data);

File FR();
FR.open2(file);
unit.cmp(FR.read(-1), data_text, 'file content check');

unlink(file);
