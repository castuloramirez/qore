#!/usr/bin/env qr
# -*- mode: qore; indent-tabs-mode: nil -*-

%require-types
%enable-all-warnings
%new-style

%requires ../../../../qlib/QUnit.qm

%exec-class ConstInitTest

class ConstInitTest inherits QUnit::Test {
    constructor() : QUnit::Test("Const init test", "1.0") {
        addTestCase("Test", \testConstInit());
        set_return_value(main());
    }

    testConstInit() {
        Program p(PO_LOCKDOWN);
        
        string c = "
class B {
    abstract string getName();
}

class C inherits B {
    string getName() { return 'C'; }
}

class D {
    public {
        const C = new C();
    }
}
";
        
        assertThrows("ILLEGAL-CLASS-INSTANTIATION", sub () { p.parse(c, "test"); });
    }
}

