#!/usr/bin/env qore
%require-types
%new-style
%enable-all-warnings
%requires UnitTest
%requires Util
%requires ../../../../qlib/FixedLengthUtil.qm

UnitTest unit();

string file = tmp_location() + "/file.fll";
unlink(file);

list data = (
    ("type": "type1", "record": ("col1" : 11111, "col2" : "bb")),
    ("type": "type2", "record": ("col3" : "c", "col4" : "ddd", "col5" : "31122014")),
    ("type": "type1", "record": ("col1" : 22222, "col2" : "gg")),
);

string data_text = "11111bb\ncddd31122014\n22222gg\n";

hash specs = (
    "type1" : (
        "col1" : (
            "length" : 5,
            "type"   : "int"
        ),
        "col2" : (
            "length" : 2,
            "type"   : "string",
        ),
    ),
    "type2" : (
        "col3" : (
            "length" : 1,
            "type"   : "string",
        ),
        "col4" : (
            "length" : 3,
            "type"   : "string",
        ),
        "col5" : (
            "length"   : 8,
            "type"     : "date",
            "format"   : "DDMMYYYY",
            "timezone" : "Europe/Prague",
        ),
    ),
);

hash global_options = (
    "eol" : "\n",
);

FixedLengthFileWriter w(file, specs, global_options);
w.write(data);

File FR();
FR.open2(file);
unit.cmp(FR.read(-1), data_text, 'file content check');

unlink(file);
