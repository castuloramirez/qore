#!/usr/bin/env qr
# -*- mode: qore; indent-tabs-mode: nil -*-

%require-types
%enable-all-warnings
%new-style

%requires UnitTest

UnitTest unit();

Program p(PO_LOCKDOWN);

string str = "
class B {
    abstract string getName();
}

class C inherits B {
    string getName() { return 'C'; }
}

class D {
    public {
        const c = new C();
    }
}
";

unit.exception(sub () { p.parse(str, "test"); }, (), "constant initialization using class with uncommitted changes", 'ILLEGAL-CLASS-INSTANTIATION', "class");
